from langchain.agents import create_sql_agent
from langchain_experimental.sql import SQLDatabase
from langchain.llms import HuggingFacePipeline
from transformers import pipeline

# Step 1: Load a local LLM model (e.g., GPT-Neo)
local_llm_pipeline = pipeline("text-generation", model="EleutherAI/gpt-neo-1.3B")
local_llm = HuggingFacePipeline(pipeline=local_llm_pipeline)

# Step 2: Connect to the PostgreSQL database
db = SQLDatabase.from_uri("postgresql://postgres:jayavanth@27@localhost:5432/dummy_data")

# Step 3: Create a LangChain SQL Agent
agent_executor = create_sql_agent(
    llm=local_llm,
    db=db,
    agent_type="zero-shot-react-description",  # Agent for SQL generation
    verbose=True
)

# Step 4: Define user query and get results
user_query = "List all users where version = 1."
response = agent_executor.run(user_query)
print("Agent Response:", response)
